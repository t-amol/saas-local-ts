flowchart LR
  subgraph client[Client]
    FE[React TS Webpack+LESS]
  end

  FE -->|HTTP| NGINX[Reverse Proxy nginx]
  NGINX -->|/api/*| GUNI[Gunicorn]
  NGINX -->|/app/*| FE
  NGINX -->|/dashboards| OSD[OpenSearch Dashboards]
  NGINX -->|/grafana optional| GRAF[Grafana]

  subgraph backend[Backend]
    GUNI --> DRF[Django DRF]
    DRF --> PG[(Postgres)]
    DRF --> REDIS[(Redis)]
    DRF --> MINIO[(MinIO S3 compatible)]
    DRF --> OS[OpenSearch BM25 Vector]
    DRF --> RAG[FastAPI RAG Service]
    DRF --> DUCK[(DuckDB)]
    DRF --> DDB[(DynamoDB Local)]
  end

  REDIS <-->|broker results| CELERY[Celery Worker Beat]
  RAG --> FAISS[(FAISS Index)]
  RAG --> HF[Sentence Transformers Cache]

  subgraph observability[Observability optional]
    LOGP[Promtail] --> LOKI[(Loki)]
    LOKI --> GRAF
    NGINX -.->|logs| LOGP
    DRF -.->|logs| LOGP
    CELERY -.->|logs| LOGP
    RAG -.->|logs| LOGP
  end
